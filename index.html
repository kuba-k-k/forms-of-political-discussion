<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formy dyskusji politycznej</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="js/script.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

  </head>

  <body>
    <div class="w100 container-fluid" id="container">
      <div class="row pt-3 pb-5" style="margin-left: 28px;">
        <div class="col">
          <h1>Formy dyskursu politycznego w mediach</h1>
        </div>
      </div>
      <div class="row" style="margin-left: 28px;">
        <div class="col-auto">
          <select id="axesValues" class="form-select small" aria-label="Oś y">
            <option value="participation_x_accessibility" selected>Partycypacja publiczności / Dostępność publiczna</option>
            <option value="moderator_x_formality">Rola moderatora / Stopień formalności</option>
          </select>
        </div>
      </div>
      <div class="row" id="filler">
        <div class="col w100" id="chart">
        </div>
      </div>
    </div>

    <div id="infoMenu">
      <header class="mb-0">
        <div class="pb-3">
            <span class="h2" id="menu-title"></span>
            <span class="h4" id="menu-icons"></span>
        </div>
        <span class="close">&times;</span>
      </header>
      <p id="menu-description">Key Information</p>
      <div id="menu-bullets"></div>
      <div id="menu-description-rows"></div>
      <div id="video-placeholder"></div>
    </div>

    <script type="text/javascript">
      $(document).ready(function() {
        // data
        const data = [
          {id: "debate", name: "Debata", formality: 100, accessibility: 30, participation: 40, moderator: 100, radius: 97, type: "single"},
          {id: "panel", name: "Panel dyskusyjny", formality: 60, accessibility: 50, participation: 50, moderator: 50, radius: 87, type: "single"},
          {id: "town_hall", name: "Town hall", formality: 50, accessibility: 60, participation: 80, moderator: 30, radius: 85, type: "single"},
          {id: "talk_show", name: "Talk show", formality: 70, accessibility: 40, participation: 30, moderator: 80, radius: 91, type: "single"},
          {id: "protest", name: "Protest publiczny", formality: 20, accessibility: 90, participation: 90, moderator: 10, radius: 97, type: "single"},
          {id: "press_conference", name: "Konferencja prasowa", formality: 90, accessibility: 30, participation: 20, moderator: 20, radius: 86, type: "single"},
          {id: "interview", name: "Wywiad", formality: 80, accessibility: 10, participation: 10, moderator: 90, radius: 92, type: "single"},
          {id: "social_media", name: "Social media / blog", formality: 10, accessibility: 100, participation: 100, moderator: 0, radius: 96, type: "single"},
        ]

        const descriptions = {
          "interview": {
            name: "Wywiad",
            media: ["bi-tv", "bi-newspaper", "bi-broadcast", "bi-globe"],
            description: "Wywiad polityczny to rodzaj rozmowy, która ma na celu uzyskanie informacji, opinii lub komentarzy od polityków lub innych osób związanych z życiem politycznym na temat określonych kwestii politycznych, społecznych lub gospodarczych. Jest to istotne narzędzie dziennikarskie, które pozwala na przybliżenie opinii publicznej stanowisk polityków oraz na lepsze zrozumienie działań podejmowanych w życiu politycznym.",
            bullets: [
              {bullet: "Tematyka", text: "Wywiady polityczne mogą dotyczyć różnorodnych tematów związanych z życiem politycznym, takich jak aktualne wydarzenia, projekty ustaw, decyzje rządowe, sprawy międzynarodowe, polityka społeczna, gospodarcza czy kwestie dotyczące bezpieczeństwa narodowego."},
              {bullet: "Uczestnicy", text: "Uczestnikami wywiadów politycznych mogą być politycy na różnych szczeblach, od lokalnych działaczy po przywódców państw. Mogą to być także eksperci, analitycy polityczni, liderzy opinii publicznej lub przedstawiciele innych grup zainteresowanych określonymi tematami."},
              {bullet: "Forma", text: "Wywiady polityczne mogą mieć różne formy, od krótkich wywiadów udzielanych przez polityków w trakcie konferencji prasowych, po długie i szczegółowe rozmowy przeprowadzane przez dziennikarzy w studiu telewizyjnym czy radiowym. Mogą być też udzielane na łamach gazet, portalach internetowych lub w formie podcastów."},
              {bullet: "Cel", text: "Celem wywiadów politycznych jest uzyskanie rzetelnej informacji, wyjaśnienie stanowiska rozmówcy, zadanie kluczowych pytań, konfrontacja go z faktycznymi danymi czy sprzecznością w jego wypowiedziach oraz przekazanie tej wiedzy odbiorcom."},
              {bullet: "Kontekst", text: "Ważne jest również umieszczenie wywiadu w kontekście aktualnych wydarzeń politycznych i społecznych, aby odbiorcy mogli lepiej zrozumieć, dlaczego dana kwestia jest ważna i jakie są jej konsekwencje."},
            ],
            youtubes: ["https://www.youtube.com/watch?v=rmgtOX1Gkfs", "https://www.youtube.com/watch?v=QmGBaEWk_9k"],
          },
        }

        // svg setup
        const width = $("#chart").width();
        const height = $("#chart").height();
        const margin = 40;
        const margin_top = 10;
        const svg = d3.select('#chart').append('svg')
          .attr('width', width)
          .attr('height', height);

        // axes
        const borderLines = [
          {x1: margin, y1: margin_top, x2: width - margin, y2: margin_top},
          {x1: width - margin, y1: margin_top, x2: width - margin, y2: height - margin},
          {x1: margin, y1: height - margin, x2: width - margin, y2: height - margin},
          {x1: margin, y1: margin_top, x2: margin, y2: height - margin}
        ];

        borderLines.forEach(line => {
          svg.append('line')
            .attr('x1', line.x1)
            .attr('y1', line.y1)
            .attr('x2', line.x2)
            .attr('y2', line.y2)
            .style('stroke', 'grey')
            .style('stroke-width', 0.5);
        });

        svg.append('text')
          .attr("class", "x-axis main-label")
          .attr('x', width / 2)
          .attr('y', height - margin + 20)
          .attr('text-anchor', 'middle')
          .text('Dostępność publiczna')
          .style('font-size', '16px');
        svg.append('text')
          .attr("class", "x-axis bottom-label")
          .attr('x', 40)
          .attr('y', height - margin + 20)
          .attr('text-anchor', 'start')
          .text('Niska')
          .style('font-size', '12px');
        svg.append('text')
          .attr("class", "x-axis top-label")
          .attr('x', width - margin)
          .attr('y', height - margin + 20)
          .attr('text-anchor', 'end')
          .text('Wysoka')
          .style('font-size', '12px');

        svg.append('text')
          .attr("class", "y-axis main-label")
          .attr('transform', `translate(30, ${height / 2}) rotate(-90)`)
          .attr('text-anchor', 'middle')
          .text('Partycypacja publiczności')
          .style('font-size', '16px');
        svg.append('text')
          .attr("class", "y-axis bottom-label")
          .attr('transform', `translate(30, ${height - margin}) rotate(-90)`)
          .attr('text-anchor', 'start')
          .text('Niska')
          .style('font-size', '12px');
        svg.append('text')
          .attr("class", "y-axis top-label")
          .attr('transform', `translate(30, ${margin_top}) rotate(-90)`)
          .attr('text-anchor', 'end')
          .text('Wysoka')
          .style('font-size', '12px');

        // scales
        const xScale = d3.scaleLinear()
          .domain([0, 110])
          .range([50, width - 50]);
        const yScale = d3.scaleLinear()
          .domain([-50, 150])
          .range([height - 50, 50]);

        const uniqueNames = Array.from(new Set(data.map(d => d.name)));
        const nameToIndex = new Map(uniqueNames.map((name, index) => [name, index / (uniqueNames.length - 1)]));
        const color = d3.scaleSequential(d3.interpolateWarm) // Example with a cool color interpolator
          .domain([0, 1]);

        // simulation
        const simulation = d3.forceSimulation(data)
          .force('x', d3.forceX(d => xScale(d.accessibility)).strength(0.2))
          .force('y', d3.forceY(d => yScale(d.participation)).strength(0.2))
          .force('collide', d3.forceCollide(d => d.radius + 2))
          .on('tick', ticked);

        // ticked
        function ticked() {
            const u = svg.selectAll('.node')
                .data(data, d => d.name);

            const entered = u.enter().append('g')
                .attr('class', 'node');

            entered.append('circle')
                .attr("id", d => d.id)
                .attr('class', 'bubble')
                .attr('r', d => d.radius)
                .attr('fill', d => color(nameToIndex.get(d.name)))
                .attr('stroke', 'grey')
                .attr('stroke-width', 1);

            entered.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', "0.35em")
                .text(d => d.name)
                .style('fill', '#333');

            u.merge(entered)
                .attr('transform', d => `translate(${d.x}, ${d.y})`);
        }

        // start simulation
        simulation.alpha(1).restart();

        // update simulation
        function updateSimulation() {
            var axesValues = $('#axesValues').val();
            let xAxisAttribute = axesValues.split("_")[2];
            let yAxisAttribute = axesValues.split("_")[0];

            var labels = ["main", "top", "bottom"];
            const axesDict = {
              formality: {main: "Stopień formalności", bottom: "Niski", top: "Wysoki"},
              accessibility: {main: "Dostępność publiczna", bottom: "Niska", top: "Wysoka"},
              participation: {main: "Partycypacja publiczności", bottom: "Niska", top: "Wysoka"},
              moderator: {main: "Rola moderatora", bottom: "Brak", top: "Krytyczna"},
            }

            d3.select('#chart svg').selectAll(".y-axis, .x-axis")
              .transition().duration(250)
              .style("opacity", 0)
            labels.forEach(label => {
              d3.select('#chart svg').selectAll(`.x-axis.${label}-label`)
                .transition().duration(250).delay(250).text(axesDict[xAxisAttribute][label]).style("opacity", 1)
              d3.select('#chart svg').selectAll(`.y-axis.${label}-label`)
                .transition().duration(250).delay(250).text(axesDict[yAxisAttribute][label]).style("opacity", 1)
            })

            simulation
                .force('x', d3.forceX(d => xScale(d[xAxisAttribute])).strength(0.2))
                .force('y', d3.forceY(d => yScale(d[yAxisAttribute])).strength(0.2))
                .alpha(1)
                .restart();
        }


        // on select change
        $('#axesValues').change(function() {
            updateSimulation();
        });

        // on bubble click
        $('#chart').on('click', '.bubble', function() {
            var data = d3.select(this).data()[0];
            var id = data.id;

            $('#menu-title').text(descriptions[id].name);

            $('#menu-icons').empty();
            descriptions[id].media.forEach(function(iconClass) {
                $('#menu-icons').append(`<span class="px-2 text-primary"><i class="bi ${iconClass}"></i></span>`);
            });

            $('#menu-description').text(descriptions[id].description);

            $('#menu-bullets').empty();
            descriptions[id].bullets.forEach(function(bullet) {
                //$('#menu-bullets').append($(`<a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse-${bullet.bullet}" role="button" aria-expanded="false" aria-controls="collapse-${bullet.bullet}">`).text(bullet.bullet));
                $('#menu-description-rows').append($(`<div class="row pb-1" id="row-${bullet.bullet}">`));
                $(`#row-${bullet.bullet}`).append($(`<div class="col-2">`).html(`<button class='btn w-100 rounded border bg-primary text-white'>${bullet.bullet}</button>`));
            });

            $('#video-placeholder').empty();
            descriptions[id].youtubes.forEach(function(url) {
                var videoId = url.split('v=')[1];
                var embedUrl = "https://www.youtube.com/embed/" + videoId;
                var iframe = $('<iframe>').attr({
                    src: embedUrl,
                    width: "100%",
                    height: "315",
                    frameborder: "0",
                    allow: "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",
                    allowfullscreen: true
                });
                $('#video-placeholder').append(iframe);
            });
            $('#infoMenu').css('right', '0');
        });

        $('#infoMenu .close').on('click', function() {
            $('#infoMenu').css('right', '-100%');
        });



      });
    </script>



  </body>

</html>
