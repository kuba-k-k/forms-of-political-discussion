<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formy dyskusji politycznej</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="js/script.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

  </head>

  <body>
    <div class="w100">
      <div id="chart" class="w100"></div>
    </div>

    <script type="text/javascript">
      // data
      const data = [
        {name: "Debata", formality: 60, accessibility: 70, participation: 40, type: 'parent', radius: 100, children: [
          {name: "W stylu oksfordzkim", radius: 20},
          {name: "Przekrojowa", radius: 20},
          {name: "Otwarta", radius: 30}
        ]},
        {name: "Panel dyskusyjny", formality: 60, accessibility: 60, participation: 50, type: 'single', radius: 80},
        {name: "Town hall", formality: 50, accessibility: 80, participation: 80, type: 'single', radius: 90},
        {name: "Protest publiczny", formality: 20, accessibility: 100, participation: 100, type: 'single', radius: 90},
        {name: "Konferencja prasowa", formality: 90, accessibility: 30, participation: 20, type: 'single', radius: 80},
        {name: "Wywiad", formality: 80, accessibility: 10, participation: 10, type: 'single', radius: 100},
      ];

      // svg setup
      const width = $("#chart").width();
      const height = 600;
      const margin = 40;
      const svg = d3.select('#chart').append('svg')
        .attr('width', width)
        .attr('height', height);

      // axes
      const borderLines = [
        {x1: margin, y1: margin, x2: width - margin, y2: margin},
        {x1: width - margin, y1: margin, x2: width - margin, y2: height - margin},
        {x1: margin, y1: height - margin, x2: width - margin, y2: height - margin},
        {x1: margin, y1: margin, x2: margin, y2: height - margin}
      ];

      borderLines.forEach(line => {
        svg.append('line')
          .attr('x1', line.x1)
          .attr('y1', line.y1)
          .attr('x2', line.x2)
          .attr('y2', line.y2)
          .style('stroke', 'grey')
          .style('stroke-width', 0.5);
      });

      svg.append('text')
        .attr('x', width / 2)
        .attr('y', height - margin + 20)
        .attr('text-anchor', 'middle')
        .text('Stopień formalności')
        .style('font-size', '16px');
      svg.append('text')
        .attr('x', 40)
        .attr('y', height - margin + 20)
        .attr('text-anchor', 'start')
        .text('Niski')
        .style('font-size', '12px');
      svg.append('text')
        .attr('x', width - margin)
        .attr('y', height - margin + 20)
        .attr('text-anchor', 'end')
        .text('Wysoki')
        .style('font-size', '12px');

      svg.append('text')
        .attr('transform', `translate(30, ${height / 2}) rotate(-90)`)
        .attr('text-anchor', 'middle')
        .text('Dostępność publiczna')
        .style('font-size', '16px');

      svg.append('text')
        .attr('transform', `translate(30, ${height - margin}) rotate(-90)`)
        .attr('text-anchor', 'start')
        .text('Niska')
        .style('font-size', '12px');

      svg.append('text')
        .attr('transform', `translate(30, ${margin}) rotate(-90)`)
        .attr('text-anchor', 'end')
        .text('Wysoka')
        .style('font-size', '12px');


      // scales
      const xScale = d3.scaleLinear()
        .domain([0, 110])
        .range([50, width - 50]);
      const yScale = d3.scaleLinear()
        .domain([-50, 150])
        .range([height - 50, 50]);

      const uniqueNames = Array.from(new Set(data.map(d => d.name).concat(data.flatMap(d => d.children ? d.children.map(child => child.name) : []))));
      const nameToIndex = new Map(uniqueNames.map((name, index) => [name, index / (uniqueNames.length - 1)]));
      const color = d3.scaleSequential(d3.interpolateWarm) // Example with a cool color interpolator
        .domain([0, 1]);



      const simulation = d3.forceSimulation(data)
        .force('x', d3.forceX(d => xScale(d.formality)).strength(0.2))
        .force('y', d3.forceY(d => yScale(d.participation)).strength(0.2))
        .force('collide', d3.forceCollide(d => d.radius + 2))
        .on('tick', ticked);

      function ticked() {
        const u = svg.selectAll('.node')
          .data(data, d => d.name)
          .join('g')
            .attr('class', 'node')
            .attr('transform', d => `translate(${d.x}, ${d.y})`);

        // Single nodes
        u.filter(d => d.type === 'single').append('circle')
          .attr('r', d => d.radius)
          .attr('fill', d => color(nameToIndex.get(d.name)))
          .attr('stroke', 'black')
          .attr('stroke-width', 1);

        // Add labels for single nodes
        u.filter(d => d.type === 'single').append('text')
          .attr('text-anchor', 'middle')
          .attr('dy', "0.35em") // Vertically center text within the circle
          .text(d => d.name)
          .style('fill', '#333');

        // Packed nodes
        const packedGroups = u.filter(d => d.type === 'parent');
        packedGroups.each(function(d) {
          const node = d3.select(this);
          const packedData = pack(d);
          node.selectAll('circle.packed')
            .data(packedData.leaves())
            .join('circle')
              .attr('class', 'packed')
              .attr('r', d => d.r)
              .attr('cx', d => d.x - packedData.r) // Offset to center
              .attr('cy', d => d.y - packedData.r) // Offset to center
              .attr('fill', d => color(nameToIndex.get(d.data.name)))
              .attr('stroke', 'black')
              .attr('stroke-width', 1);

          // Add labels for packed circles
          node.selectAll('text.packed')
            .data(packedData.leaves())
            .join('text')
              .attr('class', 'packed')
              .attr('x', d => d.x - packedData.r) // Center text over packed circle
              .attr('y', d => d.y - packedData.r) // Center text vertically
              .attr('text-anchor', 'middle')
              .attr('dy', "0.35em") // Vertically center text
              .text(d => d.data.name) // Use the name from the data bound to each leaf
              .style('fill', '#333')
              .style('font-size', '10px');  // Smaller font size for packed circles

          node.append('circle')
            .attr('r', d.radius)
            .attr('stroke', 'black')
            .attr('stroke-dasharray', '5,5')
            .attr('fill', 'none');

          // Label for the parent node above the dashed line
          node.append('text')
            .attr('y', -d.radius - 10) // Position above the dashed line
            .attr('text-anchor', 'middle')
            .text(d => d.name)
            .style('fill', '#333');
        });

        // Titles might still be useful for tooltips; adjust if needed
        u.selectAll('title')
          .data(d => [d])
          .join('title')
            .text(d => d.name);
      }



      function pack(parentData) {
        const hierarchy = d3.hierarchy({children: parentData.children}).sum(d => d.radius);
        return d3.pack()
        .size([parentData.radius * 2, parentData.radius * 2])
          .padding(2)(hierarchy);
      }

       simulation.alpha(1).restart();
     </script>



  </body>

</html>
